<head>
  <link rel="stylesheet" type="text/css" href="stmarkdown2.css">
<script type="text/x-mathjax-config">
  MathJax.Hub.Config({tex2jax: {inlineMath: [['$','$'], ['\\(','\\)']]}});
</script>
<script type="text/javascript" async
  src="https://cdn.mathjax.org/mathjax/latest/MathJax.js?config=TeX-AMS_CHTML">
</script>
<script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>
<script>
		$(document).ready(function() {
		  // Add button after each code chunk
		  $('.sourceCode').after('<button class="show-code">Show code</button>');

		  // Hide code after each chunk
		  $('.sourceCode').hide();

		  // Show code when button is clicked
		  $('.show-code').click(function() {
		    $(this).prev('.sourceCode').toggle();
		  });
		});
</script>
<script type="text/javascript">
$(document).ready(function() {
  $("button.toggle-code").click(function() {
    $(this).toggleClass("collapsed");
    $(this).siblings("div.sourceCode").toggleClass("hide");
  });
});
</script>
</head>
<script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>
<head>
  <link rel="stylesheet" type="text/css" href="stmarkdown2.css">
<script type="text/x-mathjax-config">
  MathJax.Hub.Config({tex2jax: {inlineMath: [['$','$'], ['\\(','\\)']]}});
</script>
<script type="text/javascript" async
  src="https://cdn.mathjax.org/mathjax/latest/MathJax.js?config=TeX-AMS_CHTML">
</script>
<script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>
<script>
		$(document).ready(function() {
		  // Add button after each code chunk
		  $('.sourceCode').after('<button class="show-code">Show code</button>');

		  // Hide code after each chunk
		  $('.sourceCode').hide();

		  // Show code when button is clicked
		  $('.show-code').click(function() {
		    $(this).prev('.sourceCode').toggle();
		  });
		});
</script>
<script type="text/javascript">
$(document).ready(function() {
  $("button.toggle-code").click(function() {
    $(this).toggleClass("collapsed");
    $(this).siblings("div.sourceCode").toggleClass("hide");
  });
});
</script>
</head>
<script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>
<pre><code>. clear all

. cap noi which tabout
c:\ado\plus\t\tabout.ado
*! 2.0.8 Ian Watson 15mar2019
*! tabout version 3 (beta) available at: http://tabout.net.au

. if _rc==111 {
.         cap noi ssc install tabout
.         }

. cap noi which pathutil
c:\ado\plus\p\pathutil.ado
*! version 2.2.0 19nov2020 daniel klein

. if _rc==111 {
.         cap noi net install pathutil, from(&quot;http://fmwww.bc.edu/repec/bocode/p/&quot;) 
.         }

. cap noi which pathutil
c:\ado\plus\p\pathutil.ado
*! version 2.2.0 19nov2020 daniel klein

. if _rc==111 {
.         ssc install dirtools    
.         }

. cap noi which project
c:\ado\plus\p\project.ado
*! version 1.3.1  22dec2013  picard@netbox.com

. if _rc==111 {   
.         ssc install project
.         }

. cap noi which stipw
c:\ado\plus\s\stipw.ado
*! Version 1.0.0 17Jan2022

. if _rc==111 {   
.         ssc install stipw
.         }

. cap noi which stpm2
c:\ado\plus\s\stpm2.ado
*! version 1.7.5 May2021

. if _rc==111 {   
.         ssc install stpm2
.         }       

. cap noi which rcsgen
c:\ado\plus\r\rcsgen.ado
*! version 1.5.9 13FEB2022

. if _rc==111 {   
.         ssc install rcsgen
.         }       

. cap noi which matselrc
c:\ado\plus\m\matselrc.ado
*! NJC 1.1.0 20 Apr 2000  (STB-56: dm79)

. if _rc==111 {           
. cap noi net install dm79, from(http://www.stata.com/stb/stb56)
.         }

. cap noi which pbalchk
c:\ado\plus\p\pbalchk.ado
*! Version: 3.0.0
*! Author:  Mark Lunt
*! Date:    October 2, 2017 @ 12:47:35

. if _rc==111 {
.         cap noi net install pbalchk.pkg
.         }

</code></pre>
<h1><a href="#exercise" id="exercise">Exercise</a></h1>
<p>Date created: 20:38:41 10 Mar 2023.</p>
<p>Get the folder</p>
<pre><code>
E:\Mi unidad\Alvacast\SISTRAT 2022 (github)


Fecha: 10 Mar 2023, considerando un SO Windows para el usuario: andre

</code></pre>
<head>
  <link rel="stylesheet" type="text/css" href="stmarkdown2.css">
<script type="text/x-mathjax-config">
  MathJax.Hub.Config({tex2jax: {inlineMath: [['$','$'], ['\\(','\\)']]}});
</script>
<script type="text/javascript" async
  src="https://cdn.mathjax.org/mathjax/latest/MathJax.js?config=TeX-AMS_CHTML">
</script>
<script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>
<script>
		$(document).ready(function() {
		  // Add button after each code chunk
		  $('.sourceCode').after('<button class="show-code">Show code</button>');

		  // Hide code after each chunk
		  $('.sourceCode').hide();

		  // Show code when button is clicked
		  $('.show-code').click(function() {
		    $(this).prev('.sourceCode').toggle();
		  });
		});
</script>
<script type="text/javascript">
$(document).ready(function() {
  $("button.toggle-code").click(function() {
    $(this).toggleClass("collapsed");
    $(this).siblings("div.sourceCode").toggleClass("hide");
  });
});
</script>
</head>
<script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>
<p>Path data= ;</p>
<p>Tiempo: 10 Mar 2023, considerando un SO Windows</p>
<p>The file is located and named as: E:\Mi unidad\Alvacast\SISTRAT 2022 (github)fiscalia_mariel_oct_2022_match_SENDA_pris.dta</p>
<p>=============================================================================</p>
<h2><a href="#structure-database-and-survival" id="structure-database-and-survival">Structure database and survival</a></h2>
<p>=============================================================================</p>
<p>We open the files</p>
<pre><code>. use &quot;fiscalia_mariel_jan_2023_match_SENDA.dta&quot;, clear

. encode escolaridad_rec, gen(esc_rec)

. encode sex, generate(sex_enc)

. encode sus_principal_mod, gen(sus_prin_mod)

. encode freq_cons_sus_prin, gen(fr_sus_prin)

. encode compromiso_biopsicosocial, gen(comp_biosoc)

. encode tenencia_de_la_vivienda_mod, gen(ten_viv)

. *encode dg_cie_10_rec, generate(dg_cie_10_mental_h) *already numeric
. encode dg_trs_cons_sus_or, generate(sud_severity_icd10)

. encode macrozona, generate(macrozone)

. 
. recode policonsumo (0=0 &quot;No polysubstance use&quot;) (1=1 &quot;Polysubstance use&quot;), gen(poly)
(0 differences between policonsumo and poly)

. 
. lab var poly &quot;Polysubstance use&quot;

. 
. *rename Clasificación clas 
. *encode Clasificación, gen(clas)
. *drop Clasificación
. 
. gen     clas = 0

. replace clas = 1 if strpos(Clasificación,&quot;Mixta&quot;)&gt;0
(6,835 real changes made)

. replace clas = 2 if strpos(Clasificación,&quot;Rural&quot;)&gt;0
(5,750 real changes made)

. recode clas (0=0 &quot;Urban&quot;) (1=1 &quot;Mixed&quot;) (2=2 &quot;Rural&quot;), gen(clas2) 
(0 differences between clas and clas2)

. drop clas

. 
. rename clas2 clas

. 
. lab var clas &quot;Classification of Municipallities of Residence into Rural-Urban&quot; 

. lab var offender_d &quot;Offenders (proxy of event; missing not event)&quot; 

. 
. lab var porc_pobr &quot;Poverty of municipallities of Residence (numeric)&quot; 

. lab var comuna_residencia_cod_rec &quot;Municipallity of Residence (code)&quot; 

. 
. drop Clasificación

. 
. *región
. format comuna_residencia_cod_rec 

  variable name              display format
  -----------------------------------------
  comuna_residencia_cod_rec  %-9s
  -----------------------------------------

. gen comuna_residencia_cod_rec_num = real(comuna_residencia_cod_rec)
(2 missing values generated)

. gen comuna_residencia_cod_rec_str = string(comuna_residencia_cod_rec_num ,&quot;%05.0f&quot;)

. 
. gen region=substr(comuna_residencia_cod_rec_str, 1,2)

. gen region_num = real(region)
(2 missing values generated)

. 
. drop comuna_residencia_cod_rec_num

. 
. lab var comuna_residencia_cod_rec &quot;Municipallity of Residence (code)&quot; 

. lab var region &quot;Region&quot; 

. lab var region_num &quot;Region (numeric)&quot; 

. lab var age_at_censor_date &quot;Age at censorship date (2019-11-13)&quot; 

. 
. /*
&gt; label define country1 1 &quot;Ukraine&quot; 2 &quot;Bulgaria&quot; 3 &quot;Georgia&quot; 4 &quot;Russia&quot; 5 &quot;Lithuania&quot; 6 &quot;Czech Republic&quot; ///
&gt; 7 &quot;Hungary&quot; 8 &quot;Slovakia&quot; 9 &quot;Portugal&quot; 10 &quot;Croatia&quot; 11 &quot;Ireland&quot; 12 &quot;Estonia&quot; 13 &quot;France&quot; 14 &quot;Cyprus&quot; ///
&gt; 15 &quot;Poland&quot; 16 &quot;Germany&quot; 17 &quot;Great Britain&quot; 18 &quot;Slovenia&quot; 19 &quot;Israel&quot; 20 &quot;Spain&quot; 21 &quot;Belgium&quot; ///
&gt; 22 &quot;Netherlands&quot; 23 &quot;Switzerland&quot; 24 &quot;Sweden&quot; 25 &quot;Norway&quot; 26 &quot;Denmark&quot; 27 &quot;Finland&quot; 
&gt; label values country country1
&gt; */
. 
</code></pre>
<p>Then we set the data base in surirval format and bring the urban-rural classification of municipallities from this <a href="&quot;https://view.officeapps.live.com/op/view.aspx?src=https%3A%2F%2Fwww.masvidarural.gob.cl%2Fwp-content%2Fuploads%2F2021%2F04%2FClasificacion-comunas-PNDR.xlsx&amp;wdOrigin=BROWSELINK&quot;">link</a>.</p>
<p>===================================================================================</p>
<h2><a href="#survival" id="survival">Survival</a></h2>
<p>===================================================================================</p>
<pre><code>. *si no está perdido cod_region, significa que hubo un registro (0/1) y el tiempo es el tiempo desde 
. *set the indicator
. gen event=0

. replace event=1 if !missing(offender_d)
(22,287 real changes made)

. 
. // censorship
. gen diff1a= age_at_censor_date-edad_al_ing_1 

. // time to event
. gen diff2b= age_offending_imp-edad_al_ing_1 

. // conditional
. gen diff2= cond(event==1, diff2b, diff1a) //age_offending_imp-edad_al_ing_1

. // completion
. gen diff1b= edad_al_egres_imp-edad_al_ing_1 // edad_al_egres_imp

. gen comp= cond(strpos(motivodeegreso_mod_imp_rec,&quot;Treatment completion&quot;), 1, 0)

. gen contact_js= event

. // time to tr. completion
. gen diff1 = cond(comp==1, diff1b, diff1a)

. 
. gen edad_al_egres_imp_rec = cond(comp==1, edad_al_egres_imp, age_at_censor_date)

. 
. lab var diff2 &quot;Time to offending&quot; 

. lab var diff1 &quot;Time to tr. completion&quot; 

. lab var edad_al_egres_imp_rec &quot;Time to tr. completion (if not, censorship)&quot; 

. 
. lab var contact_js &quot;Contact with justice system status&quot; 

. lab var comp &quot;Tr. completion status&quot; 

. 
. drop comuna_residencia_cod_rec_str event 

. drop diff1a diff1b diff2b

. 
. //id in numeric format
. *encode hash_key, gen(id)
. *gen id= encode(hash_key)
. egen long id = group(hash_key)

. lab var id &quot;HASH (numeric)&quot; 

. 
. //Age at admission, corrected when 0 days in treatment
. gen edad_al_ing_1_mod = cond(diff1&lt;0, edad_al_ing_1 -0.01,edad_al_ing_1)

. lab var edad_al_ing_1_mod &quot;Age at admission (corrected)&quot; 

. 
. //Sort variables
. order id hash_key edad_al_ing_1 edad_al_egres_imp age_offending_imp age_at_censor_date diff1 diff2 comp contact_js

. /*
&gt; global covs_2_mod &quot;i.policonsumo i.sus_prin_mod i.fr_sus_prin edad_al_ing_1 edad_ini_cons i.sex_enc i.esc_rec i.ten_viv i.dg_cie_10_rec i.sud_severity_icd10 n_off_vio n_off_acq n_off_sud i.clas porc_pobr i.macrozo
&gt; ne&quot;
&gt; global covs_3_mod &quot;policonsumo sus_prin_mod fr_sus_prin edad_al_ing_1 edad_ini_cons sex_enc esc_rec ten_viv dg_cie_10_rec n_off_vio n_off_acq n_off_sud clas porc_pobr macrozone&quot;
&gt; */
. 
. //a string variable, so it is encoded
. destring id_centro, replace
id_centro: all characters numeric; replaced as int
(16 missing values generated)

. 
. gen diff1c= cond(diff1&lt;0.001, 0.01, diff1)

. 
. drop diff1

. 
. rename diff1c diff1

. lab var diff1 &quot;Time to tr. completion&quot; 

. 
. //Sort variables
. order id hash_key edad_al_ing_1 edad_al_egres_imp age_offending_imp age_at_censor_date diff1 diff2 comp contact_js

</code></pre>
<p>We show a table of missing values</p>
<pre><code>. misstable sum poly sus_prin_mod fr_sus_prin edad_al_ing_1 edad_ini_cons sex_enc esc_rec ten_viv dg_cie_10_rec n_off_vio n_off_acq n_off_sud clas porc_pobr macrozone
                                                               Obs&lt;.
                                                +------------------------------
               |                                | Unique
      Variable |     Obs=.     Obs&gt;.     Obs&lt;.  | values        Min         Max
  -------------+--------------------------------+------------------------------
  sus_prin_mod |         1              70,862  |      5          1           5
   fr_sus_prin |       355              70,508  |      5          1           5
  edad_ini_c~s |     5,924              64,939  |     68          5          74
       esc_rec |       317              70,546  |      3          1           3
       ten_viv |     4,058              66,805  |      5          1           5
     porc_pobr |         2              70,861  |   &gt;500   .0003295    .6305783
     macrozone |        16              70,847  |      3          1           3
  -----------------------------------------------------------------------------

</code></pre>
<p>And missing patterns</p>
<pre><code>. misstable pat poly sus_prin_mod fr_sus_prin edad_al_ing_1 edad_ini_cons sex_enc esc_rec ten_viv dg_cie_10_rec n_off_vio n_off_acq n_off_sud clas porc_pobr macrozone

         Missing-value patterns
           (1 means complete)

              |   Pattern
    Percent   |  1  2  3  4    5  6  7
  ------------+------------------------
       86%    |  1  1  1  1    1  1  1
              |
        7     |  1  1  1  1    1  1  0
        5     |  1  1  1  1    1  0  1
       &lt;1     |  1  1  1  1    1  0  0
       &lt;1     |  1  1  1  1    0  1  1
       &lt;1     |  1  1  1  0    1  1  1
       &lt;1     |  1  1  1  1    0  0  1
       &lt;1     |  1  1  1  0    1  1  0
       &lt;1     |  1  1  1  0    1  0  1
       &lt;1     |  1  1  1  1    0  0  0
       &lt;1     |  1  1  1  1    0  1  0
       &lt;1     |  1  1  1  0    1  0  0
       &lt;1     |  1  1  0  1    1  0  1
       &lt;1     |  1  1  0  1    1  1  0
       &lt;1     |  1  1  0  1    1  1  1
       &lt;1     |  1  0  1  1    1  1  1
       &lt;1     |  1  1  1  0    0  1  1
       &lt;1     |  0  1  1  0    0  0  0
       &lt;1     |  1  1  0  1    1  0  0
       &lt;1     |  1  1  1  0    0  0  0
       &lt;1     |  1  1  1  0    0  0  1
       &lt;1     |  1  1  1  0    0  1  0
  ------------+------------------------
      100%    |

  Variables are  (1) sus_prin_mod  (2) porc_pobr  (3) macrozone  (4) esc_rec  (5) fr_sus_prin  (6) ten_viv  (7) edad_ini_cons

</code></pre>
<pre><code>. tab ya
variable ya not found
r(111);

</code></pre>
<p>86% of patients showed complete data, and 2% had missing data due to tenure status of the household and age of onset of substance use.</p>
